"use strict";(self.webpackChunkclient=self.webpackChunkclient||[]).push([[90],{9090:function(e,n,t){t.d(n,{g0:function(){return N}});Promise.resolve(!1);var r=Promise.resolve(!0),o=Promise.resolve();function i(e,n){return e||(e=0),new Promise((function(t){return setTimeout((function(){return t(n)}),e)}))}function a(){return Math.random().toString(36).substring(2)}var s=0,u=0;function c(){var e=(new Date).getTime();return e===s?1e3*e+ ++u:(s=e,u=0,1e3*e)}var d={create:function(e){var n={messagesCallback:null,bc:new BroadcastChannel(e),subFns:[]};return n.bc.onmessage=function(e){n.messagesCallback&&n.messagesCallback(e.data)},n},close:function(e){e.bc.close(),e.subFns=[]},onMessage:function(e,n){e.messagesCallback=n},postMessage:function(e,n){try{return e.bc.postMessage(n,!1),o}catch(t){return Promise.reject(t)}},canBeUsed:function(){if("undefined"===typeof window)return!1;if("function"===typeof BroadcastChannel){if(BroadcastChannel._pubkey)throw new Error("BroadcastChannel: Do not overwrite window.BroadcastChannel with this module, this is not a polyfill");return!0}return!1},type:"native",averageResponseTime:function(){return 150},microSeconds:c},l=function(){function e(e){this.ttl=e,this.map=new Map,this._to=!1}return e.prototype.has=function(e){return this.map.has(e)},e.prototype.add=function(e){var n=this;this.map.set(e,f()),this._to||(this._to=!0,setTimeout((function(){n._to=!1,function(e){var n=f()-e.ttl,t=e.map[Symbol.iterator]();for(;;){var r=t.next().value;if(!r)return;var o=r[0];if(!(r[1]<n))return;e.map.delete(o)}}(n)}),0))},e.prototype.clear=function(){this.map.clear()},e}();function f(){return(new Date).getTime()}function h(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=JSON.parse(JSON.stringify(e));return"undefined"===typeof n.webWorkerSupport&&(n.webWorkerSupport=!0),n.idb||(n.idb={}),n.idb.ttl||(n.idb.ttl=45e3),n.idb.fallbackInterval||(n.idb.fallbackInterval=150),e.idb&&"function"===typeof e.idb.onclose&&(n.idb.onclose=e.idb.onclose),n.localstorage||(n.localstorage={}),n.localstorage.removeTimeout||(n.localstorage.removeTimeout=6e4),e.methods&&(n.methods=e.methods),n.node||(n.node={}),n.node.ttl||(n.node.ttl=12e4),n.node.maxParallelWrites||(n.node.maxParallelWrites=2048),"undefined"===typeof n.node.useFastPath&&(n.node.useFastPath=!0),n}var p="pubkey.broadcast-channel-0-",m="messages",v={durability:"relaxed"};function b(){if("undefined"!==typeof indexedDB)return indexedDB;if("undefined"!==typeof window){if("undefined"!==typeof window.mozIndexedDB)return window.mozIndexedDB;if("undefined"!==typeof window.webkitIndexedDB)return window.webkitIndexedDB;if("undefined"!==typeof window.msIndexedDB)return window.msIndexedDB}return!1}function w(e){e.commit&&e.commit()}function g(e,n){var t=e.transaction(m,"readonly",v),r=t.objectStore(m),o=[],i=IDBKeyRange.bound(n+1,1/0);if(r.getAll){var a=r.getAll(i);return new Promise((function(e,n){a.onerror=function(e){return n(e)},a.onsuccess=function(n){e(n.target.result)}}))}return new Promise((function(e,a){var s=function(){try{return i=IDBKeyRange.bound(n+1,1/0),r.openCursor(i)}catch(e){return r.openCursor()}}();s.onerror=function(e){return a(e)},s.onsuccess=function(r){var i=r.target.result;i?i.value.id<n+1?i.continue(n+1):(o.push(i.value),i.continue()):(w(t),e(o))}}))}function _(e){return function(e,n){var t=(new Date).getTime()-n,r=e.transaction(m,"readonly",v),o=r.objectStore(m),i=[];return new Promise((function(e){o.openCursor().onsuccess=function(n){var o=n.target.result;if(o){var a=o.value;a.time<t?(i.push(a),o.continue()):(w(r),e(i))}else e(i)}}))}(e.db,e.options.idb.ttl).then((function(n){return function(e,n){if(e.closed)return Promise.resolve([]);var t=e.db.transaction(m,"readwrite",v).objectStore(m);return Promise.all(n.map((function(e){var n=t.delete(e);return new Promise((function(e){n.onsuccess=function(){return e()}}))})))}(e,n.map((function(e){return e.id})))}))}function y(e){e.closed||L(e).then((function(){return i(e.options.idb.fallbackInterval)})).then((function(){return y(e)}))}function L(e){return e.closed?o:e.messagesCallback?g(e.db,e.lastCursorId).then((function(n){var t=n.filter((function(e){return!!e})).map((function(n){return n.id>e.lastCursorId&&(e.lastCursorId=n.id),n})).filter((function(n){return function(e,n){return e.uuid!==n.uuid&&!n.eMIs.has(e.id)&&!(e.data.time<n.messagesCallbackTime)}(n,e)})).sort((function(e,n){return e.time-n.time}));return t.forEach((function(n){e.messagesCallback&&(e.eMIs.add(n.id),e.messagesCallback(n.data))})),o})):o}var k={create:function(e,n){return n=h(n),function(e){var n=b(),t=p+e,r=n.open(t);return r.onupgradeneeded=function(e){e.target.result.createObjectStore(m,{keyPath:"id",autoIncrement:!0})},new Promise((function(e,n){r.onerror=function(e){return n(e)},r.onsuccess=function(){e(r.result)}}))}(e).then((function(t){var r={closed:!1,lastCursorId:0,channelName:e,options:n,uuid:a(),eMIs:new l(2*n.idb.ttl),writeBlockPromise:o,messagesCallback:null,readQueuePromises:[],db:t};return t.onclose=function(){r.closed=!0,n.idb.onclose&&n.idb.onclose()},y(r),r}))},close:function(e){e.closed=!0,e.db.close()},onMessage:function(e,n,t){e.messagesCallbackTime=t,e.messagesCallback=n,L(e)},postMessage:function(e,n){return e.writeBlockPromise=e.writeBlockPromise.then((function(){return function(e,n,t){var r={uuid:n,time:(new Date).getTime(),data:t},o=e.transaction([m],"readwrite",v);return new Promise((function(e,n){o.oncomplete=function(){return e()},o.onerror=function(e){return n(e)},o.objectStore(m).add(r),w(o)}))}(e.db,e.uuid,n)})).then((function(){var n,t;0===(n=0,t=10,Math.floor(Math.random()*(t-n+1)+n))&&_(e)})),e.writeBlockPromise},canBeUsed:function(){return!!b()},type:"idb",averageResponseTime:function(e){return 2*e.idb.fallbackInterval},microSeconds:c},C="pubkey.broadcastChannel-";function P(){var e;if("undefined"===typeof window)return null;try{e=window.localStorage,e=window["ie8-eventlistener/storage"]||window.localStorage}catch(n){}return e}function E(e){return C+e}function S(){var e=P();if(!e)return!1;try{var n="__broadcastchannel_check";e.setItem(n,"works"),e.removeItem(n)}catch(t){return!1}return!0}var M={create:function(e,n){if(n=h(n),!S())throw new Error("BroadcastChannel: localstorage cannot be used");var t=a(),r=new l(n.localstorage.removeTimeout),o={channelName:e,uuid:t,eMIs:r};return o.listener=function(e,n){var t=E(e),r=function(e){e.key===t&&n(JSON.parse(e.newValue))};return window.addEventListener("storage",r),r}(e,(function(e){o.messagesCallback&&e.uuid!==t&&e.token&&!r.has(e.token)&&(e.data.time&&e.data.time<o.messagesCallbackTime||(r.add(e.token),o.messagesCallback(e.data)))})),o},close:function(e){var n;n=e.listener,window.removeEventListener("storage",n)},onMessage:function(e,n,t){e.messagesCallbackTime=t,e.messagesCallback=n},postMessage:function(e,n){return new Promise((function(t){i().then((function(){var r=E(e.channelName),o={token:a(),time:(new Date).getTime(),data:n,uuid:e.uuid},i=JSON.stringify(o);P().setItem(r,i);var s=document.createEvent("Event");s.initEvent("storage",!0,!0),s.key=r,s.newValue=i,window.dispatchEvent(s),t()}))}))},canBeUsed:S,type:"localstorage",averageResponseTime:function(){var e=navigator.userAgent.toLowerCase();return e.includes("safari")&&!e.includes("chrome")?240:120},microSeconds:c},I=c,B=new Set;var x={create:function(e){var n={name:e,messagesCallback:null};return B.add(n),n},close:function(e){B.delete(e)},onMessage:function(e,n){e.messagesCallback=n},postMessage:function(e,n){return new Promise((function(t){return setTimeout((function(){Array.from(B).filter((function(n){return n.name===e.name})).filter((function(n){return n!==e})).filter((function(e){return!!e.messagesCallback})).forEach((function(e){return e.messagesCallback(n)})),t()}),5)}))},canBeUsed:function(){return!0},type:"simulate",averageResponseTime:function(){return 5},microSeconds:I},T=[d,k,M];var D,O=new Set,Q=0,N=function(e,n){this.id=Q++,O.add(this),this.name=e,D&&(n=D),this.options=h(n),this.method=function(e){var n=[].concat(e.methods,T).filter(Boolean);if(e.type){if("simulate"===e.type)return x;var t=n.find((function(n){return n.type===e.type}));if(t)return t;throw new Error("method-type "+e.type+" not found")}e.webWorkerSupport||(n=n.filter((function(e){return"idb"!==e.type})));var r=n.find((function(e){return e.canBeUsed()}));if(r)return r;throw new Error("No usable method found in "+JSON.stringify(T.map((function(e){return e.type}))))}(this.options),this._iL=!1,this._onML=null,this._addEL={message:[],internal:[]},this._uMP=new Set,this._befC=[],this._prepP=null,function(e){var n=e.method.create(e.name,e.options);t=n,t&&"function"===typeof t.then?(e._prepP=n,n.then((function(n){e._state=n}))):e._state=n;var t}(this)};function j(e,n,t){var r={time:e.method.microSeconds(),type:n,data:t};return(e._prepP?e._prepP:o).then((function(){var n=e.method.postMessage(e._state,r);return e._uMP.add(n),n.catch().then((function(){return e._uMP.delete(n)})),n}))}function W(e){return e._addEL.message.length>0||e._addEL.internal.length>0}function J(e,n,t){e._addEL[n].push(t),function(e){if(!e._iL&&W(e)){var n=function(n){e._addEL[n.type].forEach((function(e){var t=1e5,r=e.time-t;n.time>=r&&e.fn(n.data)}))},t=e.method.microSeconds();e._prepP?e._prepP.then((function(){e._iL=!0,e.method.onMessage(e._state,n,t)})):(e._iL=!0,e.method.onMessage(e._state,n,t))}}(e)}function R(e,n,t){e._addEL[n]=e._addEL[n].filter((function(e){return e!==t})),function(e){if(e._iL&&!W(e)){e._iL=!1;var n=e.method.microSeconds();e.method.onMessage(e._state,null,n)}}(e)}N._pubkey=!0,N.prototype={postMessage:function(e){if(this.closed)throw new Error("BroadcastChannel.postMessage(): Cannot post message after channel has closed "+JSON.stringify(e));return j(this,"message",e)},postInternal:function(e){return j(this,"internal",e)},set onmessage(e){var n={time:this.method.microSeconds(),fn:e};R(this,"message",this._onML),e&&"function"===typeof e?(this._onML=n,J(this,"message",n)):this._onML=null},addEventListener:function(e,n){J(this,e,{time:this.method.microSeconds(),fn:n})},removeEventListener:function(e,n){R(this,e,this._addEL[e].find((function(e){return e.fn===n})))},close:function(){var e=this;if(!this.closed){O.delete(this),this.closed=!0;var n=this._prepP?this._prepP:o;return this._onML=null,this._addEL.message=[],n.then((function(){return Promise.all(Array.from(e._uMP))})).then((function(){return Promise.all(e._befC.map((function(e){return e()})))})).then((function(){return e.method.close(e._state)}))}},get type(){return this.method.type},get isClosed(){return this.closed}};var A="[object process]"===Object.prototype.toString.call("undefined"!==typeof process?process:0)?function(e){process.on("exit",(function(){return e()})),process.on("beforeExit",(function(){return e().then((function(){return process.exit()}))})),process.on("SIGINT",(function(){return e().then((function(){return process.exit()}))})),process.on("uncaughtException",(function(n){return e().then((function(){console.trace(n),process.exit(101)}))}))}:function(e){if("function"===typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope){var n=self.close.bind(self);self.close=function(){return e(),n()}}else{if("function"!==typeof window.addEventListener)return;window.addEventListener("beforeunload",(function(){e()}),!0),window.addEventListener("unload",(function(){e()}),!0)}},U=new Set,F=!1;function G(e){if(F||(F=!0,A(z)),"function"!==typeof e)throw new Error("Listener is no function");return U.add(e),{remove:function(){return U.delete(e)},run:function(){return U.delete(e),e()}}}function z(){var e=[];return U.forEach((function(n){e.push(n()),U.delete(n)})),Promise.all(e)}var K=function(e,n){var t=this;this.broadcastChannel=e,this._options=n,this.isLeader=!1,this.hasLeader=!1,this.isDead=!1,this.token=a(),this._aplQ=o,this._aplQC=0,this._unl=[],this._lstns=[],this._dpL=function(){},this._dpLC=!1;var r=function(e){"leader"===e.context&&("death"===e.action&&(t.hasLeader=!1),"tell"===e.action&&(t.hasLeader=!0))};this.broadcastChannel.addEventListener("internal",r),this._lstns.push(r)};function V(e,n){var t={context:"leader",action:n,token:e.token};return e.broadcastChannel.postInternal(t)}K.prototype={applyOnce:function(e){var n=this;if(this.isLeader)return i(0,!0);if(this.isDead)return i(0,!1);if(this._aplQC>1)return this._aplQ;var t=function(){if(n.isLeader)return r;var t,o=!1,a=new Promise((function(e){t=function(){o=!0,e()}})),s=function(e){"leader"===e.context&&e.token!=n.token&&("apply"===e.action&&e.token>n.token&&t(),"tell"===e.action&&(t(),n.hasLeader=!0))};n.broadcastChannel.addEventListener("internal",s);var u=e?4*n._options.responseTime:n._options.responseTime;return V(n,"apply").then((function(){return Promise.race([i(u),a.then((function(){return Promise.reject(new Error)}))])})).then((function(){return V(n,"apply")})).then((function(){return Promise.race([i(u),a.then((function(){return Promise.reject(new Error)}))])})).catch((function(){})).then((function(){return n.broadcastChannel.removeEventListener("internal",s),!o&&function(e){e.isLeader=!0,e.hasLeader=!0;var n=G((function(){return e.die()}));e._unl.push(n);var t=function(n){"leader"===n.context&&"apply"===n.action&&V(e,"tell"),"leader"!==n.context||"tell"!==n.action||e._dpLC||(e._dpLC=!0,e._dpL(),V(e,"tell"))};return e.broadcastChannel.addEventListener("internal",t),e._lstns.push(t),V(e,"tell")}(n).then((function(){return!0}))}))};return this._aplQC=this._aplQC+1,this._aplQ=this._aplQ.then((function(){return t()})).then((function(){n._aplQC=n._aplQC-1})),this._aplQ.then((function(){return n.isLeader}))},awaitLeadership:function(){return this._aLP||(this._aLP=function(e){if(e.isLeader)return o;return new Promise((function(n){var t=!1;function r(){t||(t=!0,e.broadcastChannel.removeEventListener("internal",o),n(!0))}e.applyOnce().then((function(){e.isLeader&&r()})),function n(){return i(e._options.fallbackInterval).then((function(){if(!e.isDead&&!t)return e.isLeader?void r():e.applyOnce(!0).then((function(){e.isLeader?r():n()}))}))}();var o=function(n){"leader"===n.context&&"death"===n.action&&(e.hasLeader=!1,e.applyOnce().then((function(){e.isLeader&&r()})))};e.broadcastChannel.addEventListener("internal",o),e._lstns.push(o)}))}(this)),this._aLP},set onduplicate(e){this._dpL=e},die:function(){var e=this;return this._lstns.forEach((function(n){return e.broadcastChannel.removeEventListener("internal",n)})),this._lstns=[],this._unl.forEach((function(e){return e.remove()})),this._unl=[],this.isLeader&&(this.hasLeader=!1,this.isLeader=!1),this.isDead=!0,V(this,"death")}}}}]);
//# sourceMappingURL=90.5a3b3946.chunk.js.map